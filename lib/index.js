"use strict";var $e=Object.create;var C=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty;var je=(e,t)=>{for(var r in t)C(e,r,{get:t[r],enumerable:!0})},U=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Ne(t))!Ie.call(e,a)&&a!==r&&C(e,a,{get:()=>t[a],enumerable:!(n=He(t,a))||n.enumerable});return e};var s=(e,t,r)=>(r=e!=null?$e(Te(e)):{},U(t||!e||!e.__esModule?C(r,"default",{value:e,enumerable:!0}):r,e)),Ue=e=>U(C({},"__esModule",{value:!0}),e);var qe={};je(qe,{CLIError:()=>m,create:()=>We,printCommand:()=>d});module.exports=Ue(qe);var D=s(require("chalk")),se=require("epicfail"),ce=s(require("execa")),b=require("fs"),O=require("license.js"),u=s(require("path")),pe=s(require("yargs-interactive"));var G=require("cross-spawn"),S=s(require("fs")),z=s(require("path"));function A(e,t=[],r={}){return new Promise((n,a)=>{(0,G.spawn)(e,t,{stdio:"inherit",...r}).on("close",p=>{if(p!==0)return a(p);n(p)})})}function R(e,t){return S.default.existsSync(z.default.resolve(t,e))}function _(e){try{return S.default.readdirSync(e).filter(t=>!t.startsWith(".")).length!==0}catch(t){if((t==null?void 0:t.code)==="ENOENT")return!1;throw t}}var Y=s(require("execa")),Z=s(require("gitconfig"));async function B(e){d("git init"),await(0,Y.default)("git init",{shell:!0,cwd:e})}async function W(){try{return(await Z.default.get({location:"global"})).user??{}}catch{return{}}}var L=require("detect-package-manager");async function q(){return await(0,L.detect)()}async function J(e,{pm:t}){let r,n;switch(t){case"npm":{r="npm",n=["init","-y"],process.chdir(e);break}case"yarn":{r="yarnpkg",n=["init","-y","--cwd",e];break}case"pnpm":{r="pnpm",n=["init","-y"],process.chdir(e);break}}d(r,...n);try{await A(r,n,{stdio:"inherit",shell:!0})}catch(a){throw new m(`Failed to install dependencies: ${a}`)}}async function K(e,t){let r,n;switch(t){case"npm":{r="npm",n=["install"],process.chdir(e);break}case"yarn":{r="yarnpkg",n=["install","--cwd",e];break}case"pnpm":{r="pnpm",n=["install","--dir",e];break}}d(r,...n);try{await A(r,n,{stdio:"inherit",shell:!0})}catch(a){throw new m(`Failed to install dependencies: ${a}`)}}async function Q(e,t,{isDev:r=!1,pm:n}){let a,c;switch(n){case"npm":{a="npm",c=["install",r?"-D":"-S",...t],process.chdir(e);break}case"yarn":{a="yarnpkg",c=["add","--cwd",e,...t,r?"-D":""];break}case"pnpm":{a="pnpm",c=["add","--dir",e,...t,r?"-D":""];break}}d(a,...c);try{await A(a,c,{stdio:"inherit",shell:!0})}catch(p){throw new m(`Failed to add dependencies: ${p}`)}}var w=s(require("fs")),X=s(require("globby")),g=s(require("handlebars")),ee=s(require("is-utf8")),y=s(require("path")),$=s(require("slash")),te=require("uuid");function re(e){return e.split(/[-_\s]+/)}function Ge(e){return re(k(e)).join(" ")}g.default.registerHelper("space",Ge);function k(e){return e.replace(/[\r\n]/g,"")}g.default.registerHelper("trim",k);function ze(e){return k(e).toUpperCase()}g.default.registerHelper("upper",ze);function Re(e,t){let r=t&&t.hash&&t.hash.space;return k(e).toLowerCase()}g.default.registerHelper("lower",Re);function H(e,t){let r=t&&t.hash&&t.hash.space;return re(k(e)).map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(r?" ":"")}g.default.registerHelper("capital",H);function _e(e){return H(e).replace(/^./,t=>t.toLowerCase())}g.default.registerHelper("camel",_e);function ne(e){return H(e).replace(/(?<=([a-z](?=[A-Z])|[A-Za-z](?=[0-9])))(?=[A-Z0-9])/g,"_").toLowerCase()}g.default.registerHelper("snake",ne);function Ye(e){return ne(e).replace(/_/g,"-")}g.default.registerHelper("kebab",Ye);function Ze(){return(0,te.v4)()}g.default.registerHelper("uuid",Ze);function V(e,t){return g.default.compile(e.toString(),{noEscape:!0})(t)}function Be(e){try{let t=y.default.dirname(e);w.default.mkdirSync(t,{recursive:!0})}catch{}}function ie(e){return w.default.readdirSync(e).filter(t=>!t.startsWith("."))}async function ae(e){let t=await(0,X.default)((0,$.default)(e.sourceDir),{dot:!0});for(let r of t){let n=y.default.relative(e.sourceDir,r),a=V((0,$.default)(y.default.resolve(e.targetDir,n)),e.view).replace(new RegExp(`${y.sep}gitignore$`,"g"),`${y.sep}.gitignore`);Be(a);let c=w.default.readFileSync(r),p=c;(0,ee.default)(c)&&(p=Buffer.from(V(c,e.view))),w.default.writeFileSync(a,p,"utf-8")}}var m=class extends Error{constructor(t){super(t),this.name="CLIError"}};function d(...e){console.log(D.default.gray(">",...e))}async function We(e,t){(0,se.epicfail)(require.main.filename,{assertExpected:i=>i.name==="CLIError"});let r=await W(),{templateRoot:n,modifyName:a,extra:c={},after:p,caveat:v,defaultDescription:le="description",defaultAuthor:me=r.name??"Your name",defaultEmail:ge=r.email??"Your email",defaultTemplate:fe="default",defaultLicense:ue="MIT",defaultPackageManager:de=void 0,promptForDescription:ye=!0,promptForAuthor:he=!0,promptForEmail:we=!0,promptForTemplate:ke=!1,promptForLicense:be=!0,promptForPackageManager:ve=!1,skipGitInit:Pe=!1,skipNpmInstall:xe=!1}=t,P=process.argv[2];if(P===void 0)throw new m(`${e} <name>`);let N=P===".",x=N?u.default.basename(process.cwd()):a?await Promise.resolve(a(P)):P,o=N?process.cwd():(0,u.resolve)(x);if(_(o))throw new m(`${o} is not empty directory.`);let F=ie(n);if(F.length===0)throw new m("No template found");let Ce=[...(0,O.availableLicenses)(),"UNLICENSED"],Ae=F.length>1,De={interactive:{default:!0},description:{type:"input",describe:"Description",default:le,prompt:ye?"if-no-arg":"never"},author:{type:"input",describe:"Author name",default:me,prompt:he?"if-no-arg":"never"},email:{type:"input",describe:"Author email",default:ge,prompt:we?"if-no-arg":"never"},template:{type:"list",describe:"Template",default:fe,prompt:Ae&&ke?"if-no-arg":"never",choices:F},license:{type:"list",describe:"License",choices:Ce,default:ue,prompt:be?"if-no-arg":"never"},"node-pm":{type:"list",describe:"Package manager to use for installing packages from npm",choices:["npm","yarn","pnpm"],default:de,prompt:ve?"if-no-arg":"never"},"skip-git":{type:"confirm",describe:"Skip initializing git repository",prompt:"never"},"skip-install":{type:"confirm",describe:"Skip installing package dependencies",prompt:"never"},...c},l=await(0,pe.default)().usage("$0 <name> [args]").interactive(De),T=l.template,E=(0,u.resolve)(n,T);if(!(0,b.existsSync)(E))throw new m("No template found");let h=l["node-pm"]??await q(),Oe=["name","interactive","node-pm","nodePm"],Fe=Object.entries(l).filter(i=>i[0].match(/^[^$_]/)&&!Oe.includes(i[0])).reduce((i,f)=>(i[f[0]]=f[1],i),{}),M=new Date().getFullYear(),Ee=oe(l.author,l.email),I={...Fe,name:x,contact:Ee};console.log(`
Creating a new package in ${D.default.green(o)}.`),await ae({sourceDir:E,targetDir:o,view:{...I,year:M,packageManager:h}});try{let i=(0,O.makeLicenseSync)(l.license,{year:M,project:x,description:l.description,organization:oe(l.author,l.email)}),f=(i.header??"")+i.text+(i.warranty??"");(0,b.writeFileSync)((0,u.resolve)(o,"LICENSE"),f)}catch{}if(!(Pe||l["skip-git"]))try{console.log(`
Initializing a git repository`),await B(o)}catch(i){if((i==null?void 0:i.exitCode)==127)return;throw i}let Me=async(i,f=!1)=>{(0,b.existsSync)((0,u.join)(o,"package.json"))||await J(o,{pm:h}),await Q(o,Array.isArray(i)?i:[i],{isDev:f,pm:h})};R("package.json",o)&&!(xe||l["skip-install"])&&(console.log(`
Installing dependencies using ${h}`),await K(o,h));let j={packageDir:o,templateDir:E,year:M,packageManager:h,answers:I,run:(i,f={})=>{let[Se,...Le]=i.split(" ");return(0,ce.default)(Se,Le,{stdio:"inherit",cwd:o,...f})},installNpmPackage:Me,name:x,template:T};if(p&&await Promise.resolve(p(j)),console.log(`
Successfully created ${D.default.bold.cyan(o)}`),v)switch(typeof v){case"string":console.log(v);break;case"function":let i=await Promise.resolve(v(j));i&&console.log(i);break;default:}}function oe(e,t){return`${e}${t?` <${t}>`:""}`}0&&(module.exports={CLIError,create,printCommand});
