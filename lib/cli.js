#!/usr/bin/env node
"use strict";var Te=Object.create;var _=Object.defineProperty;var je=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty;var Ge=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of _e(t))!Ue.call(e,a)&&a!==r&&_(e,a,{get:()=>t[a],enumerable:!(n=je(t,a))||n.enumerable});return e};var o=(e,t,r)=>(r=e!=null?Te(Re(e)):{},Ge(t||!e||!e.__esModule?_(r,"default",{value:e,enumerable:!0}):r,e));var d=o(require("chalk")),fe=require("path");var D=o(require("chalk")),pe=require("epicfail"),le=o(require("execa")),v=require("fs"),O=require("license.js"),u=o(require("path")),me=o(require("yargs-interactive"));var R=require("cross-spawn"),S=o(require("fs")),U=o(require("path"));function C(e,t=[],r={}){return new Promise((n,a)=>{(0,R.spawn)(e,t,{stdio:"inherit",...r}).on("close",p=>{if(p!==0)return a(p);n(p)})})}function G(e,t){return S.default.existsSync(U.default.resolve(t,e))}function z(e){try{return S.default.readdirSync(e).filter(t=>!t.startsWith(".")).length!==0}catch(t){if((t==null?void 0:t.code)==="ENOENT")return!1;throw t}}var W=o(require("execa")),B=o(require("gitconfig"));async function Y(e){k("git init"),await(0,W.default)("git init",{shell:!0,cwd:e})}async function Z(){try{return(await B.default.get({location:"global"})).user??{}}catch{return{}}}var q=o(require("fs")),J=o(require("path")),E=require("child_process");function K(e="."){try{for(let{lockFile:r,packageManager:n}of[{lockFile:"yarn.lock",packageManager:"yarn"},{lockFile:"pnpm-lock.yaml",packageManager:"pnpm"},{lockFile:"package-lock.json",packageManager:"npm"}])if(q.default.existsSync(J.default.join(e,r)))return n;let t=process.env.npm_config_user_agent;if(t){if(t.startsWith("yarn"))return"yarn";if(t.startsWith("pnpm"))return"pnpm"}try{return(0,E.execSync)("yarn --version",{stdio:"ignore"}),"yarn"}catch{return(0,E.execSync)("pnpm --version",{stdio:"ignore"}),"pnpm"}}catch{return"npm"}}async function Q(e,{pm:t}){let r,n;switch(t){case"npm":{r="npm",n=["init","-y"],process.chdir(e);break}case"yarn":{r="yarnpkg",n=["init","-y","--cwd",e];break}case"pnpm":{r="pnpm",n=["init","-y"],process.chdir(e);break}}k(r,...n);try{await C(r,n,{stdio:"inherit",shell:!0})}catch(a){throw new g(`Failed to install dependencies: ${a}`)}}async function V(e,t){let r,n;switch(t){case"npm":{r="npm",n=["install"],process.chdir(e);break}case"yarn":{r="yarnpkg",n=["install","--cwd",e];break}case"pnpm":{r="pnpm",n=["install","--dir",e];break}}k(r,...n);try{await C(r,n,{stdio:"inherit",shell:!0})}catch(a){throw new g(`Failed to install dependencies: ${a}`)}}async function X(e,t,{isDev:r=!1,pm:n}){let a,c;switch(n){case"npm":{a="npm",c=["install",r?"-D":"-S",...t],process.chdir(e);break}case"yarn":{a="yarnpkg",c=["add","--cwd",e,...t,r?"-D":""];break}case"pnpm":{a="pnpm",c=["add","--dir",e,...t,r?"-D":""];break}}k(a,...c);try{await C(a,c,{stdio:"inherit",shell:!0})}catch(p){throw new g(`Failed to add dependencies: ${p}`)}}var w=o(require("fs")),te=o(require("globby")),m=o(require("handlebars")),re=o(require("is-utf8")),y=o(require("path")),H=o(require("slash")),ne=require("uuid");function ie(e){return e.split(/[-_\s]+/)}function ze(e){return ie(b(e)).join(" ")}m.default.registerHelper("space",ze);function b(e){return e.replace(/[\r\n]/g,"")}m.default.registerHelper("trim",b);function We(e){return b(e).toUpperCase()}m.default.registerHelper("upper",We);function Be(e,t){let r=t&&t.hash&&t.hash.space;return b(e).toLowerCase()}m.default.registerHelper("lower",Be);function L(e,t){let r=t&&t.hash&&t.hash.space;return ie(b(e)).map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(r?" ":"")}m.default.registerHelper("capital",L);function Ye(e){return L(e).replace(/^./,t=>t.toLowerCase())}m.default.registerHelper("camel",Ye);function ae(e){return L(e).replace(/(?<=([a-z](?=[A-Z])|[A-Za-z](?=[0-9])))(?=[A-Z0-9])/g,"_").toLowerCase()}m.default.registerHelper("snake",ae);function Ze(e){return ae(e).replace(/_/g,"-")}m.default.registerHelper("kebab",Ze);function qe(){return(0,ne.v4)()}m.default.registerHelper("uuid",qe);function ee(e,t){return m.default.compile(e.toString(),{noEscape:!0})(t)}function Je(e){try{let t=y.default.dirname(e);w.default.mkdirSync(t,{recursive:!0})}catch{}}function oe(e){return w.default.readdirSync(e).filter(t=>!t.startsWith("."))}async function se(e){let t=await(0,te.default)((0,H.default)(e.sourceDir),{dot:!0});for(let r of t){let n=y.default.relative(e.sourceDir,r),a=ee((0,H.default)(y.default.resolve(e.targetDir,n)),e.view).replace(new RegExp(`${y.sep}gitignore$`,"g"),`${y.sep}.gitignore`);Je(a);let c=w.default.readFileSync(r),p=c;(0,re.default)(c)&&(p=Buffer.from(ee(c,e.view))),w.default.writeFileSync(a,p,"utf-8")}}var g=class extends Error{constructor(t){super(t),this.name="CLIError"}};function k(...e){console.log(D.default.gray(">",...e))}async function ge(e,t){(0,pe.epicfail)(require.main.filename,{assertExpected:i=>i.name==="CLIError"});let r=await Z(),{templateRoot:n,modifyName:a,extra:c={},after:p,caveat:x,defaultDescription:ue="description",defaultAuthor:de=r.name??"Your name",defaultEmail:ye=r.email??"Your email",defaultTemplate:he="default",defaultLicense:ke="MIT",defaultPackageManager:we=void 0,promptForDescription:be=!0,promptForAuthor:ve=!0,promptForEmail:xe=!0,promptForTemplate:Pe=!1,promptForLicense:Ae=!0,promptForPackageManager:Ce=!1,skipGitInit:De=!1,skipNpmInstall:Oe=!1}=t,P=process.argv[2];if(P===void 0)throw new g(`${e} <name>`);let N=P===".",A=N?u.default.basename(process.cwd()):a?await Promise.resolve(a(P)):P,s=N?process.cwd():(0,u.resolve)(A);if(z(s))throw new g(`${s} is not empty directory.`);let F=oe(n);if(F.length===0)throw new g("No template found");let Fe=[...(0,O.availableLicenses)(),"UNLICENSED"],$e=F.length>1,Me={interactive:{default:!0},description:{type:"input",describe:"Description",default:ue,prompt:be?"if-no-arg":"never"},author:{type:"input",describe:"Author name",default:de,prompt:ve?"if-no-arg":"never"},email:{type:"input",describe:"Author email",default:ye,prompt:xe?"if-no-arg":"never"},template:{type:"list",describe:"Template",default:he,prompt:$e&&Pe?"if-no-arg":"never",choices:F},license:{type:"list",describe:"License",choices:Fe,default:ke,prompt:Ae?"if-no-arg":"never"},"node-pm":{type:"list",describe:"Package manager to use for installing packages from npm",choices:["npm","yarn","pnpm"],default:we,prompt:Ce?"if-no-arg":"never"},"skip-git":{type:"confirm",describe:"Skip initializing git repository",prompt:"never"},"skip-install":{type:"confirm",describe:"Skip installing package dependencies",prompt:"never"},...c},l=await(0,me.default)().usage("$0 <name> [args]").interactive(Me),I=l.template,$=(0,u.resolve)(n,I);if(!(0,v.existsSync)($))throw new g("No template found");let h=l["node-pm"]??K(),Se=["name","interactive","node-pm","nodePm"],Ee=Object.entries(l).filter(i=>i[0].match(/^[^$_]/)&&!Se.includes(i[0])).reduce((i,f)=>(i[f[0]]=f[1],i),{}),M=new Date().getFullYear(),He=ce(l.author,l.email),T={...Ee,name:A,contact:He};console.log(`
Creating a new package in ${D.default.green(s)}.`),await se({sourceDir:$,targetDir:s,view:{...T,year:M,packageManager:h}});try{let i=(0,O.makeLicenseSync)(l.license,{year:M,project:A,description:l.description,organization:ce(l.author,l.email)}),f=(i.header??"")+i.text+(i.warranty??"");(0,v.writeFileSync)((0,u.resolve)(s,"LICENSE"),f)}catch{}if(!(De||l["skip-git"]))try{console.log(`
Initializing a git repository`),await Y(s)}catch(i){if((i==null?void 0:i.exitCode)==127)return;throw i}let Le=async(i,f=!1)=>{(0,v.existsSync)((0,u.join)(s,"package.json"))||await Q(s,{pm:h}),await X(s,Array.isArray(i)?i:[i],{isDev:f,pm:h})};G("package.json",s)&&!(Oe||l["skip-install"])&&(console.log(`
Installing dependencies using ${h}`),await V(s,h));let j={packageDir:s,templateDir:$,year:M,packageManager:h,answers:T,run:(i,f={})=>{let[Ne,...Ie]=i.split(" ");return(0,le.default)(Ne,Ie,{stdio:"inherit",cwd:s,...f})},installNpmPackage:Le,name:A,template:I};if(p&&await Promise.resolve(p(j)),console.log(`
Successfully created ${D.default.bold.cyan(s)}`),x)switch(typeof x){case"string":console.log(x);break;case"function":let i=await Promise.resolve(x(j));i&&console.log(i);break;default:}}function ce(e,t){return`${e}${t?` <${t}>`:""}`}var Ke=(0,fe.resolve)(__dirname,"..","templates"),Qe=({answers:{name:e,template:t}})=>{let r=`
cd ${d.default.bold.green(e)}
`;switch(t){case"typescript":r+=`
Inside the directory, you can run several commands:

${d.default.bold.cyan("npm run dev")}
  ${d.default.gray("Starts 'tsc -w'.")}
${d.default.bold.cyan("npm run build")}
  ${d.default.gray("Build the app for production.")}

After the build, run ${d.default.cyan("node dist/cli.js <name>")} to test your app.
`;break;default:r+=`node src/cli.js <name>
`}return r+=`
Read the docs for the further information:
${d.default.yellow("https://github.com/uetchy/create-create-app/blob/master/README.md")}`,r};ge("create-create-app",{templateRoot:Ke,promptForTemplate:!0,skipNpmInstall:!0,modifyName:e=>e.startsWith("create-")?e:`create-${e}`,after:async({installNpmPackage:e})=>{console.log(`
Installing the latest version of create-create-app`),await e("create-create-app")},caveat:Qe});
